<nav aria-label="breadcrumb" class="p-3">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/home"><i class="bi bi-house-door"></i></a></li>
    <li class="breadcrumb-item"><a [routerLink]="['/roles/manage']">Roles</a></li>
    <li class="breadcrumb-item active">{{ btnName }}</li>
  </ol>
</nav>

<div class="container py-4">
  <div class="card">
    <div class="card-header">
      <h4>{{ getTitle() }}</h4>
    </div>
    <div class="card-body">
      <form [formGroup]="roleForm" (ngSubmit)="submitForm()">
        <div class="row mb-4">
          <label class="col-md-4 col-form-label">
            Role Name<span class="text-danger">*</span>
          </label>
          <div class="col-md-8">
            <input
              type="text"
              formControlName="name"
              placeholder="Enter role name"
              class="form-control"
              [ngClass]="{'is-invalid': roleForm.get('name')?.invalid && roleForm.get('name')?.touched}"
            />
            <div class="invalid-feedback">
              Role name is required and must be at least 3 characters
            </div>
          </div>
        </div>

        <div class="row mb-4">
          <label class="col-md-4 col-form-label">
            Active
          </label>
          <div class="col-md-8">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" formControlName="is_active">
              <label class="form-check-label">{{ roleForm.get('is_active')?.value ? 'Active' : 'Inactive' }}</label>
            </div>
          </div>
        </div>

        <div class="row mb-4">
          <label class="col-md-4 col-form-label">
            Role Identifier<span class="text-danger">*</span>
          </label>
          <div class="col-md-8">
            <input
              type="text"
              formControlName="role"
              placeholder="Enter role identifier"
              class="form-control"
              [ngClass]="{'is-invalid': roleForm.get('role')?.invalid && roleForm.get('role')?.touched}"
            />
            <div class="invalid-feedback">
              Role identifier is required and must be at least 3 characters
            </div>
          </div>
        </div>

        <div class="row mb-4">
          <label class="col-md-4 col-form-label">
            Permissions
          </label>
          <div class="col-md-8">
            <div class="table-responsive">
              <table class="table table-bordered">
                <thead class="bg-light">
                  <tr>
                    <th style="width: 25%">Module</th>
                    <th>Permissions</th>
                  </tr>
                </thead>
                <tbody formArrayName="modulePermissions">
                  <ng-container *ngFor="let moduleGroup of permissionModules; let i = index">
                    <tr [formGroupName]="i">
                      <td class="align-middle">
                        <div class="form-check">
                          <input 
                            type="checkbox" 
                            class="form-check-input" 
                            [id]="'module-' + i"
                            [checked]="isModuleFullySelected(i)"
                            [indeterminate]="isModulePartiallySelected(i)"
                            (change)="selectAllModulePermissions(i)"
                          >
                          <label class="form-check-label fw-bold" [for]="'module-' + i">
                            {{ moduleGroup.displayName }}
                          </label>
                        </div>
                      </td>
                      <td>
                        <div class="row">
                          <div class="col-md-6" *ngFor="let perm of moduleGroup.permissions">
                            <div class="form-check mb-2">
                              <input 
                                type="checkbox" 
                                class="form-check-input" 
                                [id]="'role-' + perm.value"
                                [value]="perm.value"
                                [checked]="isPermissionSelected(i, perm.value)"
                                (change)="togglePermission(i, perm.value, $event)"
                              >
                              <label class="form-check-label" [for]="'role-' + perm.value">
                                {{ perm.name }}
                              </label>
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </ng-container>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="row mb-4">
          <label class="col-md-4 col-form-label">
            Remarks
          </label>
          <div class="col-md-8">
            <textarea
              formControlName="remarks"
              placeholder="Enter Remarks"
              class="form-control"
            ></textarea>
          </div>
        </div>

        <div class="d-flex justify-content-end gap-2 mt-4">
          <button type="submit" class="btn btn-primary">{{ btnName }}</button>
          <button type="button" class="btn btn-secondary" (click)="cancel()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
