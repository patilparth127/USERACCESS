<nav aria-label="breadcrumb" class="p-3">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/home"><i class="bi bi-house-door"></i></a></li>
    <li class="breadcrumb-item active">Manage Users</li>
  </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mt-2 p-4">
  <div>
    <div class="input-group input-group-lg">
      <input
        type="text"
        class="form-control"
        placeholder="Search"
        [(ngModel)]="searchData"
        (ngModelChange)="search()"
      />
      <span class="input-group-text"><i class="bi bi-search"></i></span>
    </div>
  </div>
  <div>
    <!-- Only show Add User button if user has permission -->
    <a *ngIf="canCreateUser" routerLink="/users/add" class="btn btn-primary">Add User</a>
  </div>
</div>

<div class="p-4">
  <table class="table table-striped">
    <thead>
      <tr>
        <th *ngFor="let item of blocks">{{ item }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of users">
        <td>{{ item.name }}</td>
        <td>{{ item.email }}</td>
        <td>{{ item.phone }}</td>
        <td>{{ item.date_of_birth | date }}</td>

        <td>
          <span
            class="badge rounded-pill"
            [ngClass]="item.is_active ? 'bg-success' : 'bg-danger'"
          >
            {{ item.is_active ? "Active" : "Inactive" }}
          </span>
        </td>
        <td>{{ item.createdAt | date }}</td>
        <td>
          <div class="d-flex gap-2">
            <!-- Edit button - requires UpdateUser permission -->
            <a
              *ngIf="canUpdateUser"
              [routerLink]="['/users/edit', item._id]"
              class="btn btn-sm btn-outline-primary"
              title="Edit"
            >
              <i class="bi bi-pencil"></i>
            </a>

            <!-- Permissions button - requires UpdateUser permission -->
            <a
              *ngIf="canUpdateUser"
              [routerLink]="['/users/permissions', item._id]"
              class="btn btn-sm btn-outline-info"
              title="Manage Permissions"
            >
              <i class="bi bi-shield"></i>
            </a>

            <!-- Delete button - requires DeleteUser permission -->
            <button
              *ngIf="canDeleteUser"
              class="btn btn-sm btn-outline-danger"
              title="Delete"
              data-bs-toggle="modal"
              [attr.data-bs-target]="'#deleteModal' + item._id"
            >
              <i class="bi bi-trash"></i>
            </button>

            <!-- Delete Confirmation Modal -->
            <div
              class="modal fade"
              [id]="'deleteModal' + item._id"
              tabindex="-1"
              aria-hidden="true"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Delete Confirmation</h5>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    ></button>
                  </div>
                  <div class="modal-body">
                    Are you sure you want to delete this user?
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Cancel
                    </button>
                    <button
                      type="button"
                      class="btn btn-danger"
                      data-bs-dismiss="modal"
                      (click)="confirmDelete(item)"
                    >
                      Delete
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>
